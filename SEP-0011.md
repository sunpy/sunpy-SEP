# SEP-0011 -- Standards, Tools and Workflows for SunPy Project packages #

| SEP           | 11                                                           |
|---------------|--------------------------------------------------------------|
| title         | Standards, Tools and Workflows for SunPy Project packages    |
| author(s)     | Nabil Freij                                                  |
| contact email | <nabil.freij@gmail.com>                                      |
| date-creation | Before The Big Bang                                          |
| type          | standard                                                     |
| discussion    | No one said anything                                         |
| status        | accepted                                                     |

## Introduction ##

As the SunPy Project has grown, the number of packages under its control increases with plans to increase this further.
As the developers of these packages are not all the same, they have different ideas on how to develop, package and release their packages.
This has led to a divergence in the tools, workflows and standards that each package follows.

This SEP aims to unify these and provide a clear set of guidelines for all packages under the SunPy Project to follow.
The end goal is to provide a outline for the new package template to adopt which we can roll out to all existing and future repositories.
Furthermore, to aid the recruitment of new maintainers, we hope that this SEP will provide a clear set of guidelines for them to follow as well as the reasons behind them.

## Code Standards ##

The goal of the SunPy Project has always been to follow how the wide Python Community handles its standards.
This has become more formal for the Scientific Python Community with the creation of the [Scientific Python Project](https://scientific-python.org/).
While it is still in its infancy, they have been attempting to document and standardize the tools and workflows used by that community using their own [PEP style documents](https://scientific-python.org/specs/).

For now, we want to follow [PEP 8](https://peps.python.org/pep-0008/) which is common but with the idea of moving towards a [Black](https://github.com/psf/black) style in the future.

When it comes to code standards or best practices, this is where [ruff](https://github.com/astral-sh/ruff) comes in.
It's goal is to subsume all the other tools and provide a single tool to check all the code standards within the Python ecosystem.
THis means eventually replacing flake8, pylint, etc with a single tool.
Which comes with its own burden of having to configure it to work with all the different tools we use.

The idea would be to find the rules that ruff wants to enforce and the ones we disagree on, we would disable their check but the goal being to enable as many as possible.
This will be a slow process as many of our libraries are very large and have a lot of code that may need to be fixed to follow the over 700 rules that ruff provides.
As ruff can only autofix some of these rules, it will be a slow process of enabling rules, fixing the code and then enabling more rules.

Summary:

1. Use ruff and a black-like style in the future.
2. Create a ruff configuration file that can be used by all packages.

## Tools ##

To ensure that all packages under the SunPy Project are following the same standards, we need to ensure that the tools used are the same.
This means, testing frameworks, documentation tools and linters.

We also want to reduce the burden on maintainers, so also want to ensure that the tools are easy to use and configure and will autofix where possible.

With this in mind, we want to use the following tools:

1. [pytest](https://docs.pytest.org/en/stable/) for testing.
   This has become the defacto standard for testing in the Python community, it supports many plugins to extend its functionality and is easy to use.
2. [sphinx](https://www.sphinx-doc.org/en/master/) for documentation.
    This is the standard for documentation in the ScientiÔ¨Åc Python community.
    This does mean that documentation should be written in reStructuredText.
    We have also built our website and theme to work with sphinx.
3. [pre-commit](https://pre-commit.com/) for linting and formatting.
   While this directly does not do any linting or formatting, it is a tool that allows us to run other tools before a commit is made.
   This combined with git hooks or the online service, [pre-commit.ci](https://pre-commit.ci/) allows us to ensure that all code is formatted and linted without human intervention.
4. [tox](https://tox.readthedocs.io/en/latest/) for isolated environments.
   This is a tool that allows us to script the creation of isolated environments and run commands within them.
   This is used to run tests, to lint code and to build the documentation.
   It is an alternative to having to manually create and manage these environments locally.

## Build System ##

For the longest time, we have used [setuptools](https://setuptools.pypa.io/en/latest/) to build our packages.
This came in the form of ``setup.py`` files with optional `setup.cfg` files containing the package metadata.

However, [PEP 517 and PEP 518](https://peps.python.org/pep-0517/) have introduced a new way to build packages, using a ``pyproject.toml`` file.
This file contains the build system configuration and is used many other non-setuptools build backends.

The goal is to move to towards supporting **only** the `pyproject.toml` file in the future.

The one notable downside to setuptools is that it's support for non C/C++ extensions (especially fortran) are either non-existent or rudimentary.
This is one case so far the SunPy Project has not had to deal with but it is something to keep in mind.

Summary:

1. Move to `pyproject.toml` for build system configuration and package metadata.
2. Use setuptools for now, until the need for a more powerful build system arises.

## Implementation ##

The question to follow up is how do we implement this?
The answer is to use a combination of both the [sunpy-package-template](https://github.com/sunpy/package-template) and [cruft](https://cruft.github.io/cruft/).
This will allow us to create a template that can be used to create new packages and also update existing packages to the new standards.
Which will remove a lot of human interaction and reduce the workload on maintainers.

So the action items above would be implemented within the package template repository and then rolled out to all existing packages.

## Caveats ##

There are three(?) massive omissions from this SEP:

1. The lack of type checking.
   While the broader Python community has been moving towards type checking, as a community we have not.
   Partly this is due to the close integration with astropy which has not adopted type checking and would need to do so, before we could.
   The other is that Stuart hates it even though it makes things better for everyone since its "ugly".
   This is something that we should revisit in the future.
2. Continuous Integration (CI).
   We use a range of CI providers and we have been forced to move depending changes from these providers.
   So avoiding the naming of any provider in this SEP is not a good idea.
3. Usage of [GitHub](https://github.com/).
   While we have been using [GitHub](https://github.com/) for a long time and moving away from it would be a massive undertaking.
4. Usage of [ReadTheDocs](https://readthedocs.org/).
   We have been using [ReadTheDocs](https://readthedocs.org/) for to host all of our documentation.
   There is no compelling reason to move away from it.
